<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>star-travex: StiScan: Detector Material Evaluation at STAR</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">star-travex
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">StiScan: Detector Material Evaluation at STAR </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>How to use </h1>
<p>To build the library and the executable follow the installation instructions in the project's ../README.md "README.md". Once the <code>StiScan</code> library is built it can be loaded and the <code><a class="el" href="classStiScanTreeMaker.html">StiScanTreeMaker</a></code> can be added to the reconstruction chain by using the <code><a class="el" href="classStiScanTreeMaker.html">StiScanTreeMaker</a></code> option as: </p><pre class="fragment">root4star -b -q -l 'bfc.C(&lt;first_event&gt;, &lt;last_event&gt;, "&lt;your_bfc_options&gt; StiScanTreeMaker", "&lt;input_file&gt;")'
</pre><p>For a concrete example see the section below. The <code>bfc.C</code> macro can take either real or simulated data as input but for our studies of the detector material distribution we focus on specially simulated event samples with tracks perpendicular to the colliding beams. Such configuration of tracks makes the interpretation of the final results much easier. For reference, we include a simple <code>starsim</code> kumac (<code>supple/starsim_zslice_single_z.kumac</code>) to produce events with tracks in transverse planes at arbitrary integer <code>z</code> values. To use this kumac from your build directory just do: </p><pre class="fragment">export STISCAN_Z=7
starsim -w 0 -b ../supple/starsim_zslice_single_z.kumac
</pre><p>We also include a number of support shell scripts to automate the generation of such events for different <code>z</code> values by running condor jobs on the farm (see below).</p>
<p>Another way to produce a file with tracks generated in <code>z=const</code> planes is to run a special ROOT macro (<code>supple/starsim_stepper.C</code>): </p><pre class="fragment">root4star -b -l -q '../supple/starsim_stepper.C(7,10,50)'
</pre><p>which in addition to a usual <code>starsim_zslice.fz</code> file will produce a ROOT file (<code>starsim_zslice.track_history.root</code>) with a TTree containing the information about the track as GEANT propagates it through the detector material. That file can be used together with the <code>*.fz</code> one in <code>stiscan</code> in order to produce comparisons between the geometries as seen by the simulated and reconstructed tracks.</p>
<p>The <code>starsim</code> commands from above examples should produce a <code>starsim_zslise.fz</code> file that can be processed with the <code>bfc.C</code> macro as indicated earlier. The <code><a class="el" href="classStiScanTreeMaker.html">StiScanTreeMaker</a></code> option creates a ROOT file (*.stiscan.root) with a TTree that can be used to study track losses in the detector volumes with the help of <code>stiscan</code> program. <code>stiscan</code> accepts either a ROOT file with an stiscan TTree or a text file with a list of such ROOT files (one per line) as input. To produce a set of basic histograms with track energy lost in Sti volumes one can do: </p><pre class="fragment">stiscan -f path/to/my.stiscan.root
</pre><p>For more options type <code>stiscan --help</code>.</p>
<p>By default, only sensitive layers of the PXL, IST, and SSD detectors are used in the energy loss analysis. One can easily specify any other volume or a set of volumes to be considered in the analysis by using regular PERL expressions. Here are a few examples: </p><pre class="fragment">stiscan -f path/to/my.stiscan.root -p "^.*IDSM_1/PXMO_1/PXLA_[\d]+/PXT[RML]_.*$" -g
stiscan -f path/to/my_stiscan_list -l path/to/my_volume_name_pattern_list -s 0.10 -g
</pre><p>Either a regex pattern or a text file with a list of regex patterns (<code>my_volume_name_pattern_list</code> in the above example) can be provided. It is used to match the names of Sti/TGeo volumes and to select only these specific physical volumes.</p>
<p><em>Note:</em> The program expects to find a ROOT file (<code>y2014a.root</code>) with the full STAR geometry in the directory from where it was started. Such file can be produced with the following command: </p><pre class="fragment">root -l '$STAR/StarVMC/Geometry/macros/viewStarGeometry.C("y2014a")'
</pre><h1>How to produce and reconstruct massive simulation </h1>
<p>A couple of shell scripts are provided to simplify the submission of condor jobs to the farm. The following commands can be used as examples: </p><pre class="fragment">supple/submit_jobs_starsim_zslice.sh supple/job_template_starsim_zslice_kumac.xml
supple/submit_jobs_starsim_zslice.sh supple/job_template_starsim_zslice_macro.xml

supple/submit_jobs_stiscan.sh /path/to/filelist_fz
</pre><p><code>submit_jobs_stiscan_zslice.sh</code> takes an xml template as the only parameter. In our case the <code>starsim</code> command is executed to produce *.fz files with simulated events.</p>
<p><code>submit_jobs_stiscan.sh</code> utilizes the <code>supple/job_template_stiscan.xml</code> template to run over the *.fz files specified in the input list. The jobs run the standard reconstruction and in addition creates a ROOT file with an stiscan tree. The latter can be controlled by changing the BFC options hard-coded in the script.</p>
<h1>Reconstruction chain examples </h1>
<p>Run over an fzd file produced by <code>starsim</code> with the following options to produce a MuDst.root file with simulated tracker response and reconstruced events. </p><pre class="fragment">root4star -q -b -l 'bfc.C(1, 100, "fzin y2015a AgML usexgeom FieldOn tpcRS MakeEvent VFMinuit Sti BAna Idst NoSsdIt NoSvtIt StiHftC TpcHitMover TpxClu l0 Tree logger tpcDB tags emcY2 EEfs -dstout IdTruth big MiniMcMk clearmem StiScanTreeMaker", "starsim_zslice.fz")'
</pre><h1>Regular expressions matching geometry volumes used at STAR </h1>
<pre class="fragment">Beam pipe                   ^.*IDSM_1/PIPI_1/PBES_1$
Field cages                 ^.*TPCE_1/T[IO]FC.*$
PXL all volumes             ^.*IDSM_1/PXMO_.*$
PXL sensitive volumes       ^.*IDSM_1/PXMO_1/PXLA_[\d]+/LADR_\d/PXSI_[\d]+/PLAC_1.*$
PXL ribs                    ^.*IDSM_1/PXMO_1/PXLA_[\d]+/PXRB.*$
                            ^.*IDSM_1/PXMO_1/PXLA_[\d]+/PXLB.*$
IST all volumes             ^.*IDSM_1/IBMO_.*$
IST sensitive volumes       ^.*IDSM_1/IBMO_1/IBAM_[\d]+/IBLM_\d/IBSS_1.*$
SST all volumes             ^.*IDSM_1/SFMO_.*$
SST sensitive volumes       ^.*IDSM_1/SFMO_1/SFLM_[\d]+/SFSW_[\d]+/SFSL_1/SFSD_1.*$</pre> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Jan 11 2017 17:10:19 for star-travex by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.8
</small></address>
</body>
</html>

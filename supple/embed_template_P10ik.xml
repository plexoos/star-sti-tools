<?xml version="1.0" encoding="utf-8"?>
<job maxFilesPerProcess="1" fileListSyntax="xrootd" filesPerHour="1" simulateSubmission="false">

<command>
<!-- Load library -->
starver dev

<!-- Set tags file directory -->
setenv EMBEDTAGDIR /star/data20/embedding/reco/2010_zerobias/kfVertexStudies/embedDir/

<!-- Set year and day from filename -->
setenv EMYEAR `perl $STAR/StRoot/macros/embedding/getYearDayFromFile.pl -y ${FILEBASENAME}`
setenv EMDAY `perl $STAR/StRoot/macros/embedding/getYearDayFromFile.pl -d ${FILEBASENAME}`

<!-- Set log files area -->
setenv EMLOGS /star/data20/embedding/reco/2010_zerobias/kfVertexStudies/embedLogs/

<!-- Set output directory path -->
setenv EMOUTPUT &OUTPUT_DIR;/Jpsi2ee_STARlight_&FSET;_KFV/P10ik.SL10k_embed/$EMYEAR/$EMDAY
setenv EMLIST   &OUTPUT_DIR;/Jpsi2ee_STARlight_KFV/FSET&FSET;_P10ik.SL10k_embed_$EMYEAR

<!-- Print out EMYEAR and EMDAY and EMLOGS -->
echo EMYEAR   : $EMYEAR
echo EMDAY    : $EMDAY
echo EMLOGS   : $EMLOGS
echo EMOUTPUT : $EMOUTPUT
echo EMLIST   : $EMLIST

<!-- Start job -->

<!-- Run starsim with kumac file -->
set daqevents=/star/u/desilva/WorkKFvertex/2010_Jpsi2ee_embedding/Input/daq_AuAu200_SL10k_zerobias_nevents.list
set kumac=/star/u/desilva/WorkKFvertex/2010_Jpsi2ee_embedding/Input/starlight_Jpsi_ee.kumac
set fzdFile=${FILEBASENAME}.fzd
set random=`/star/u/desilva/WorkKFvertex/2010_Jpsi2ee_embedding/Input/get_random_seed`
set seed=`echo $random | awk '{print $1}'`
set ptmin=0
set ptmax=30
set nevents=`grep $FILEBASENAME $daqevents | awk '{print $2}'`
echo nevents = $nevents, random = $random, kumac = $kumac, fzdFile=$fzdFile, ptmin = $ptmin, ptmax = $ptmax
set vertex=/star/u/desilva/WorkKFvertex/2010_Jpsi2ee_embedding/Input/vertex.txt
set data=/star/u/desilva/WorkKFvertex/2010_Jpsi2ee_embedding/Input/UPCAuAu200_Jpsi_04242015_zDistributions.root

pwd
ls -la .

set my_command='root4star -l -b -q /star/u/desilva/WorkKFvertex/2010_Jpsi2ee_embedding/Input/GenerateVertex.C('$nevents','$seed',"@'$FILELIST'","'$vertex'","Jet","'$data'")'
echo
echo "Executing..."
echo  $my_command
eval '$my_command'

set my_command="starsim -w 0 -b $kumac $vertex $fzdFile $random $nevents $ptmin $ptmax"
echo
echo "Executing..."
echo  $my_command
eval '$my_command'

set BFC_MIXER_DIR=/star/u/desilva/WorkKFvertex/2010_Jpsi2ee_embedding/StRoot/macros/embedding/

set my_command='bfcMixer_UPCAuAu200_P10ik(1000, "'$INPUTFILE0'", "'$EMBEDTAGDIR/${FILEBASENAME}'.tags.root", 0, 30, -1.5, 1.5, -200, 200, 100, 8, 1, 0, "P10ikAuAu200", "FlatPt", 1, "'$fzdFile'");'
echo
echo "Executing..."
echo  $my_command

root4star -b &lt;&lt;EOF
  .L $BFC_MIXER_DIR/bfcMixer_UPCAuAu200_P10ik.C
  $my_command
  .q
EOF

ls -la .


<!-- Make output and list directory (if they don't exist) -->
if ( ! -f $EMOUTPUT ) then 
  umask 2
  mkdir -pv $EMOUTPUT
  chmod -R ug+rw $EMOUTPUT
endif
if ( ! -f $EMLIST ) then 
  umask 2
  mkdir -pv $EMLIST
  chmod -R ug+rw $EMLIST
endif


<!-- Move LOG files and csh to eliza disk, remove list files -->
mv -v $EMLOGS/P10ik/LOG/$JOBID.log $EMOUTPUT/${FILEBASENAME}.$JOBID.log
mv -v $EMLOGS/P10ik/LOG/$JOBID.elog $EMOUTPUT/${FILEBASENAME}.$JOBID.elog
gzip -f $EMOUTPUT/${FILEBASENAME}.$JOBID.log
gzip -f $EMOUTPUT/${FILEBASENAME}.$JOBID.elog
mv -v /star/data20/embedding/reco/2010_zerobias/kfVertexStudies/embedLogs/P10ik/Jpsi_ee_STARlight_20142801/LIST/sched$JOBID.csh $EMLIST/
rm -v /star/data20/embedding/reco/2010_zerobias/kfVertexStudies/embedLogs/P10ik/Jpsi_ee_STARlight_20142801/LIST/sched$JOBID.list


</command>


<!-- Define locations of ROOT files -->
<output fromScratch="*.root" toURL="$EMOUTPUT/"/>
<output fromScratch="*.fzd" toURL="$EMOUTPUT/"/>

<!-- Define locations of log/elog files -->
<stdout URL="file:&OUTPUT_DIR;/log/$JOBID.log"/>
<stderr URL="file:&OUTPUT_DIR;/log/$JOBID.elog"/>

<!-- Input daq files -->
<input URL="file:&INPUT_FILES;"/>

<!-- csh/list files -->
<Generator>
  <Location>&OUTPUT_DIR;/sums/</Location>
</Generator>

<!-- Put any locally-compiled stuffs into a sand-box -->
<SandBox installer="ZIP">
  <Package name="Localmakerlibs">
    <File>file:./.sl64_gcc447/</File>
    <File>file:./StRoot/</File>
    <File>file:./pams/</File>
  </Package>
</SandBox>
</job>

<?xml version="1.0" encoding="utf-8" ?>

<job filesPerHour="1" maxFilesPerProcess="1" fileListSyntax="xrootd" simulateSubmission="false">

<command>

starver dev

set RANDOM_SEED=`expr &RANDOM_SEED; \* 1000`

setenv BFC_OPTIONS_1 `echo &JOB_BFC_OPTIONS_1; | sed 's/\./,/g'`
setenv BFC_OPTIONS_2 `echo &JOB_BFC_OPTIONS_2; | sed 's/\./,/g'`
setenv BFC_OPTIONS_3 `echo &JOB_BFC_OPTIONS_3; | sed 's/\./,/g'`

echo
echo "SOURCE_DIR:   " &SOURCE_DIR;
echo "RANDOM_SEED:  " $RANDOM_SEED
echo

pwd
ls -al

ln -s ./GenerateVertex.C ./GenerateVertex4WBoson.C
set COMMAND='root4star -q -b ./GenerateVertex4WBoson.C(0,&JOB_NEVENTS;,'$RANDOM_SEED',"@'$FILELIST'","vertex.txt")'
echo
echo "Executing..."
echo  $COMMAND
eval '$COMMAND' >&amp;! &OUT_DIR;/log/${FILEBASENAME}_vertex.log

mv .$STAR_HOST_SYS $STAR_HOST_SYS
set COMMAND="starsim -w 0 -b ./simWRequest.kumac nevents=&JOB_NEVENTS; config=&STARSIM_MODE; run=&RUN_ID; seed=$RANDOM_SEED file=$FILEBASENAME.fzd vertexfile=vertex.txt"
echo
echo "Executing..."
echo  $COMMAND
eval '$COMMAND' >&amp;! &OUT_DIR;/log/${FILEBASENAME}_starsim.log
mv $STAR_HOST_SYS .$STAR_HOST_SYS

ln -s ./bfcMixer_pythia.C ./EmbeddingReco.C
set COMMAND='root4star -q -b ./EmbeddingReco.C(&JOB_NEVENTS;,"@'$FILELIST'","'$FILEBASENAME'.fzd","'$BFC_OPTIONS_1'","'$BFC_OPTIONS_2'","'$BFC_OPTIONS_3'","W")'
echo
echo "Executing..."
echo  $COMMAND
eval '$COMMAND' >&amp;! &OUT_DIR;/log/${FILEBASENAME}_bfcMixer.log

ls -al

echo "End of job: tralala"

</command>

<input URL="file:&JOB_INPUT_FILE;" nFiles="1" />

<output fromScratch="*.fzd"  toURL="file:&OUT_DIR;/fzd/" />
<output fromScratch="*.root" toURL="file:&OUT_DIR;/root/" />

<stdout URL="file:&OUT_DIR;/log/$FILEBASENAME.log" />

<Generator>
	<Location>&OUT_DIR;/sums/</Location>
</Generator>

<!--
Environment variable $STAR_TRAVEX_INSTALL_DIR must be set and visible at the
time of star-submit execution.
$STAR_HOST_SYS is usually set by standard STAR login script.
 -->
<SandBox installer="ZIP">
	<Package name="tarball_wbos_embed">
		<File>file:$STAR_TRAVEX_INSTALL_DIR/bfcMixer_pythia.C</File>
		<File>file:$STAR_TRAVEX_INSTALL_DIR/GenerateVertex.C</File>
		<File>file:$STAR_TRAVEX_INSTALL_DIR/simWRequest.kumac</File>
		<File>file:$STAR_TRAVEX_INSTALL_DIR/StarDb/Calibrations/tracker/</File>
		<File>file:$STAR_TRAVEX_INSTALL_DIR/.$STAR_HOST_SYS/</File>
	</Package>
</SandBox>

</job>
